app.service("wpService",["$http","API_URL","$timeout","$location","$sce",function($http,API_URL,$timeout,$location,$sce){var wpObj={posts:[],categories:[]};return wpObj.getPosts=function(category_filter,callback,tag_filter,posts_per_page,page_index,search_text){var filter="";if(search_text&&(filter=filter+"&filter[s]="+search_text),category_filter&&category_filter.length){var i,tmp="";for(i=0;i<category_filter.length-1;i++)tmp+=category_filter[i],tmp+=",";tmp+=category_filter[i],filter=filter+"&filter[category_name]="+tmp}if(tag_filter&&tag_filter.length){var i,tmp="";for(i=0;i<tag_filter.length-1;i++)tmp+=tag_filter[i],tmp+=",";tmp+=tag_filter[i],filter=filter+"&filter[tag]="+tmp}if(posts_per_page&&(filter=filter+"&filter[posts_per_page]="+posts_per_page),page_index&&(filter=filter+"&page="+page_index),API_URL.wp_api){var req={method:"GET",url:API_URL.wp_api+"posts"+filter,transformRequest:function(data,headersGetter){var headers=headersGetter();return delete headers["X-Auth-Token"],headers},withCredentials:!1};$http(req).success(function(data,status,headers,config){wpObj.posts=data;for(var i=0;i<wpObj.posts.length;i++){wpObj.posts[i].title_html=$sce.trustAsHtml(wpObj.posts[i].title),wpObj.posts[i].content_html=$sce.trustAsHtml(wpObj.posts[i].content),wpObj.posts[i].title_ab=$sce.trustAsHtml(wpObj.posts[i].title.substring(0,100)),wpObj.posts[i].title_cd=$sce.trustAsHtml(wpObj.posts[i].title.substring(0,60)),wpObj.posts[i].excerpt&&(wpObj.posts[i].excerpt_ab=$sce.trustAsHtml(wpObj.posts[i].excerpt.substring(0,360)),wpObj.posts[i].excerpt_cd=$sce.trustAsHtml(wpObj.posts[i].excerpt.substring(0,150))),wpObj.posts[i].cat_str="";var j;for(j=0;j<wpObj.posts[i].terms.category.length-1;j++)wpObj.posts[i].cat_str=wpObj.posts[i].cat_str+wpObj.posts[i].terms.category[j].name+", ";wpObj.posts[i].cat_str=wpObj.posts[i].cat_str+wpObj.posts[i].terms.category[j].name;var tmp=new Date(wpObj.posts[i].date);wpObj.posts[i].dateString=tmp.toString()}2!=posts_per_page&&(wpObj.totalPage=headers()["x-wp-totalpages"]),"function"==typeof callback&&callback.call()})}else $timeout(function(){var req={method:"GET",url:API_URL.wp_api+"posts"+filter,transformRequest:function(data,headersGetter){var headers=headersGetter();return delete headers["X-Auth-Token"],headers},withCredentials:!1};$http(req).success(function(data,status,headers,config){wpObj.posts=data,wpObj.posts;for(var i=0;i<wpObj.posts.length;i++){wpObj.posts[i].title_html=$sce.trustAsHtml(wpObj.posts[i].title),wpObj.posts[i].content_html=$sce.trustAsHtml(wpObj.posts[i].content),wpObj.posts[i].title_ab=$sce.trustAsHtml(wpObj.posts[i].title.substring(0,100)),wpObj.posts[i].title_cd=$sce.trustAsHtml(wpObj.posts[i].title.substring(0,50)),wpObj.posts[i].excerpt&&(wpObj.posts[i].excerpt_ab=$sce.trustAsHtml(wpObj.posts[i].excerpt.substring(0,360)),wpObj.posts[i].excerpt_cd=$sce.trustAsHtml(wpObj.posts[i].excerpt.substring(0,150))),wpObj.posts[i].cat_str="";var j;for(j=0;j<wpObj.posts[i].terms.category.length-1;j++)wpObj.posts[i].cat_str=wpObj.posts[i].cat_str+wpObj.posts[i].terms.category[j].name+", ";wpObj.posts[i].cat_str=wpObj.posts[i].cat_str+wpObj.posts[i].terms.category[j].name;var tmp=new Date(wpObj.posts[i].date);wpObj.posts[i].dateString=tmp.toString()}"function"==typeof callback&&callback.call()})},1e3)},wpObj.getCategories=function(callback){var req={method:"GET",url:API_URL.wp_api+"taxonomies/category/terms",headers:{},transformRequest:function(data,headersGetter){var headers=headersGetter();return delete headers["X-Auth-Token"],headers},withCredentials:!1};$http(req).success(function(data,status,headers,config){wpObj.categories=data;for(var new_list=[],i=0;i<data.length;i++){var current=data[i];current.parent||(new_list.push(current),data.splice(i,1),i--)}for(var i=0;i<data.length;i++)for(var j=0;j<new_list.length;j++)if(data[i].parent.ID==new_list[j].ID){new_list[j].children||(new_list[j].children=[]),new_list[j].children.push(data[i]),data.splice(i,1),i--;break}for(var i=0;i<data.length;i++)for(var j=0;j<new_list.length;j++)if(new_list[j].children)for(var k=0;k<new_list[j].children.length;k++)if(data[i].parent.ID==new_list[j].children[k].ID){new_list[j].children[k].children||(new_list[j].children[k].children=[]),new_list[j].children[k].children.push(data[i]),data.splice(i,1),i--;break}wpObj.categories=new_list,"function"==typeof callback&&callback.call()})},wpObj}]);